CREATE TABLE DELEGATION (
	country VARCHAR2(30) NOT NULL,
	num_athletes INT NOT NULL,
	constraint DELEGATION_PK PRIMARY KEY (Country));

CREATE TABLE HOTEL_DELEGATION (
	facility INT NOT NULL,
	delegation VARCHAR2(30) NOT NULL,
	checkin_date DATE NOT NULL,
	chechout_date DATE NOT NULL
	constraint HOTEL_DELEGATION_PK PRIMARY KEY (Facility, Delegation));

CREATE TABLE RESTAUTANT (
	facility INT NOT NULL,
	food_type VARCHAR2(30) NOT NULL,
	constraint RESTAURANT_PK

CREATE TABLE ATHLETE (
	ID_number INT NOT NULL,
	name VARCHAR2(30) NOT NULL,
	surname VARCHAR2(30) NOT NULL,
	date_birth DATE NOT NULL,
	sport VARCHAR2(30) NOT NULL,
	food_type VARCHAR2(30) NOT NULL,
	height INT NOT NULL,
	weight INT NOT NULL,
	phone INT NOT NULL,
	email VARCHAR2(50),
	delegation VARCHAR2(30) NOT NULL,
	constraint ATHLETE_PK PRIMARY KEY (ID_number));
	
CREATE TABLE PARTICIPATES (
	event INT NOT NULL,
	athlete INT NOT NULL,
	date DATE NOT NULL,
	constraint PARTICIPATES_PK PRIMARY KEY (event, athlete));

CREATE TABLE EVENT (
	code INT NOT NULL,
	sport VARCHAR2(30) NOT NULL,	
	sport_complex VARCHAR2(30) NOT NULL,
	date DATE NOT NULL,
	duration TIME NOT NULL,
	n_part INT NOT NULL,
	n_officials INT NOT NULL,
	constraint EVENT_PK PRIMARY KEY (code));

CREATE TABLE ATTENDS (
	official INT NOT NULL,
	event INT NOT NULL,
	date DATE NOT NULL,
	role VARCHAR2(30) NOT NULL,
	constraint ATTENDS_PK PRIMARY pyKEY (official, event));

CREATE TABLE EQUIPMENT (
	event INT NOT NULL,
	equipment VARCHAR2(50) NOT NULL,
	constraint EQUIPMENT_PK PRIMARY KEY (event));

CREATE TABLE VENUE (
	code INT NOT NULL,
	address VARCHAR2(50) NOT NULL,
	constraint VENUE_PK PRIMARY KEY (code));

CREATE TABLE SPORT_COMPLEX (
	name VARCHAR2(30) NOT NULL,
	opening_hours TIME NOT NULL,
	address VARCHAR(50) NOT NULL,
	manager INT NOT NULL,
	venue INT NOT NULL,
	complex_type VARCHAR2(30) NOT NULL,
	constraint SPORT_COMPLEX_PK PRIMARY KEY (name));

CREATE TABLE MULTI_COMPLEX (
	name VARCHAR2(30) NOT NULL,
	area INT NOT NULL,
	num_sports INT NOT NULL,
	num_outdoor INT NOT NULL,
	num_indoor INT NOT NULL,
	constraint MULTI_COMPLEX_PK PRIMARY KEY (name));

CREATE TABLE EMPLOYEE (
	ID_number INT NOT NULL,
	name VARCHAR2(30) NOT NULL,
	surname VARCHAR2(30) NOT NULL,
	email VARCHAR2(50),
	employee_type VARCHAR2(50) NOT NULL,
	constraint EMPLOYEE_PK PRIMARY KEY (ID_number));

CREATE TABLE FACILITY_STAFF (
	facility INT NOT NULL,
	employee INT NOT NULL,
	constraint RESTAURANT_PK PRIMARY KEY (facility, employee));

CREATE TABLE EMP_PHONE (
	ID_number INT NOT NULL,
	phone INT NOT NULL);

CREATE TABLE FACILITY (
	venue INT NOT NULL,
    ID INT NOT NULL,
	capacity INT NOT NULL,
	manager INT NOT NULL,
	facility_type VARCHAR2(30) NOT NULL,
	contraint FACILITY_PK PRIMARY KEY (venue_ID, capacity, facility_type));

ALTER TABLE HOTEL_DELEGATION
ADD CONSTRAINT HOTEL_DELEGATION_FK1 
FOREIGN KEY (delegation) REFERENCES DELEGATION(country);

ALTER TABLE HOTEL_DELEGATION
ADD CONSTRAINT HOTEL_DELEGATION_FK2 
FOREIGN KEY (facility) REFERENCES FACILITY(ID);

ALTER TABLE PARTICIPATES
ADD CONSTRAINT PARTICIPATES_FK1
FOREIGN KEY (athlete) REFERENCES ATHLETE(ID_number);

ALTER TABLE PARTICIPATES
ADD CONSTRAINT PARTICIPATES_FK2
FOREIGN KEY (event) REFERENCES EVENT(code);

ALTER TABLE EVENT
ADD CONSTRAINT EVENT_FK
FOREIGN KEY (sport_complex) REFERENCES SPORT_COMPLEX(name);

ALTER TABLE ATTENDS
ADD CONSTRAINT ATTENDS_FK1
FOREING KEY (official) REFERENCES EMPLOYEE(ID_number);

ALTER TABLE ATTENDS
ADD CONSTRAINT ATTENDS_FK
FOREIGN KEY (event) REFERENCES EVENT(code);

ALTER TABLE EQUIPMENT
ADD CONSTRAINT EQUIPMENT_FK
FOREIGN KEY (event) REFERENCES EVENT(code);

ALTER TABLE SPORT_COMPLEX
ADD CONSTRAINT SPORT_COMPLEX_FK
FOREIGN KEY (manager) REFERENCES EMPLOYEE(ID_number);

ALTER TABLE MULTI_COMPLEX
ADD CONSTRAINT MULTI_COMPLEX_FK
FOREIGN KEY (name) REFERENCES SPORT_COMPLEX(name);

ALTER TABLE FACILITY_STAFF
ADD CONSTRAINT FACILITY_STAFF_FK1
FOREIGN KEY (facility) REFERENCES FACILITY(ID);

ALTER TABLE FACILITY_STAFF
ADD CONSTRAINT FACILITY_STAFF_FK2
FOREIGN KEY (employee) REFERENCES EMPLOYEE(ID_number);

ALTER TABLE FACILITY
ADD CONSTRAINT FACILITY_FK
FOREIGN KEY (manager) REFERENCES EMPLOYEE(ID_number);

ALTER TABLE EMP_PHONE
ADD CONSTRAINT EMP_PHONE_FK
FOREIGN KEY (ID_number) REFERENCES EMPLOYEE(ID_number);

ALTER TABLE RESTAURANT
ADD CONSTRAINT RESTAURANT_FK
FOREIGN KEY (facility) REFERENCES FACILITY(ID);

create trigger trigger_number_athletes
    after insert or delete on ATHLETE
    referencing new row as nrow
    for each row
    begin
    update DELEGATION
    set num_athletes = (select count(*)
        from ATHLETE
        where ATHELTE.delegation = DELEGATION.country)
    where DELEGATION.country = nrow.delegation;
end;

